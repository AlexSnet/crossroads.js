/*!
 * Crossroads - JavaScript Routes
 * Released under the MIT license <http://www.opensource.org/licenses/mit-license.php>
 * @author Miller Medeiros
 * @version 0.2a
 * @build 13 (04/14/2011 03:44 AM)
 */
(function(a){var d,j,c=Object.prototype.toString;function i(k,l){var m=k.length;while(m--){if(k[m]===l){return m}}return -1}function b(k){return c.call(k)}d=(function(){var n=[],r=new signals.Signal();function k(x,y,w){var v=new g(x,y,w);u(v);return v}function u(v){var w=l();do{--w}while(n[w]&&v._priority<=n[w]._priority);n.splice(w+1,0,v)}function l(){return n.length}function o(v){var w=q(v);if(w>=0){n.splice(w,1)}v._destroy()}function q(v){return i(n,v)}function t(){var v=l();while(v--){n[v]._destroy()}n.length=0}function m(w){w=w||"";var v=p(w),x=v?s(w,v):null;if(v){x?v.matched.dispatch.apply(v.matched,x):v.matched.dispatch()}else{r.dispatch(w)}}function p(x){var w=l(),v;while(v=n[--w]){if(v.match(x)){return v}}return null}function s(w,v){return j.getParamValues(w,v._matchRegexp)}return{_routes:n,addRoute:k,removeRoute:o,removeAllRoutes:t,parse:m,bypassed:r,getNumRoutes:l,toString:function(){return"[crossroads numRoutes:"+l()+"]"}}}());function g(l,m,k){this._pattern=l;this._paramsId=j.getParamIds(l);this._matchRegexp=j.compilePattern(l);this.matched=new signals.Signal();if(m){this.matched.add(m)}this._priority=k||0}g.prototype={rules:void (0),match:function(k){return this._matchRegexp.test(k)&&h(this,k)},dispose:function(){d.removeRoute(this)},_destroy:function(){this.matched.dispose();this.matched=this._pattern=this._paramsId=this._matchRegexp=null},toString:function(){return'[Route pattern:"'+this._pattern+'", numListeners:'+this.matched.getNumListeners()+"]"}};function h(l,m){var n=l.rules,k=n?e(l,m):null,o;for(o in n){if(n.hasOwnProperty(o)){if(!f(n[o],k[o],k,m)){return false}}}return true}function f(m,n,k,l){switch(b(m)){case"[object RegExp]":return m.test(n);case"[object Array]":return i(m,n)!==-1;case"[object Function]":return m(n,l,k);default:return false}}function e(l,p){var m=l._paramsId,k=j.getParamValues(p,l._matchRegexp),q={},r=m.length;while(r--){q[m[r]]=k[r]}return q}j=d.patternLexer=(function(){var s=/[\\\.\+\*\?\^\$\[\]\(\)\{\}\/\'\#]/g,m=/([^\/]+)/,r=/\{([^\}]+)\}/g,q="___CR_PARAM___",p=new RegExp(q,"g");function n(y){var x=[],w;while(w=r.exec(y)){x.push(w[1])}return x}function u(w){w=w?o(w):"";w=k(w);w=l(w);return new RegExp("^"+w+"$")}function o(w){return w.replace(r,q)}function l(w){return w.replace(p,m.source)}function k(w){return w.replace(s,"\\$&")}function t(w,y){var x=y.exec(w);if(x){x.shift();x=v(x)}return x}function v(x){var z=x.length,w=[],y;while(y=x[--z]){w[z]=(y===null||y===""||isNaN(y))?y:parseFloat(y)}return w}return{getParamIds:n,getParamValues:t,compilePattern:u}}());a.crossroads=d}(window||this));