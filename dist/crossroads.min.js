/*

 Crossroads.js <http://millermedeiros.github.com/crossroads.js>
 Released under the MIT license
 Author: Miller Medeiros
 Version: 0.6.0+ - Build: 84 (2011/11/01 03:17 PM)
*/
(function(i){i("crossroads",function(e){function j(a,b){if(a.indexOf)return a.indexOf(b);else{for(var c=a.length;c--;)if(a[c]===b)return c;return-1}}function h(a,b){return"[object "+b+"]"===Object.prototype.toString.call(a)}function i(a){return a===null||a==="null"?null:a==="true"?!0:a==="false"?!1:a===m||a==="undefined"?m:a===""||isNaN(a)?a:parseFloat(a)}function k(){this._routes=[];this.bypassed=new l.Signal;this.routed=new l.Signal}function n(a,b,c,d){var f=h(a,"RegExp");this._router=d;this._pattern=
a;this._paramsIds=f?null:g.getParamIds(this._pattern);this._optionalParamsIds=f?null:g.getOptionalParamsIds(this._pattern);this._matchRegexp=f?a:g.compilePattern(a);this.matched=new l.Signal;b&&this.matched.add(b);this._priority=c||0}var l=e("signals"),g,m;k.prototype={normalizeFn:null,create:function(){return new k},shouldTypecast:!1,addRoute:function(a,b,c){a=new n(a,b,c,this);this._sortedInsert(a);return a},removeRoute:function(a){var b=j(this._routes,a);b!==-1&&this._routes.splice(b,1);a._destroy()},
removeAllRoutes:function(){for(var a=this.getNumRoutes();a--;)this._routes[a]._destroy();this._routes.length=0},parse:function(a){var a=a||"",b=this._getMatchedRoute(a),c=b?b._getParamsArray(a):null;b?(b.matched.dispatch.apply(b.matched,c),this.routed.dispatch(a,b,c)):this.bypassed.dispatch(a)},getNumRoutes:function(){return this._routes.length},_sortedInsert:function(a){var b=this._routes,c=b.length;do--c;while(b[c]&&a._priority<=b[c]._priority);b.splice(c+1,0,a)},_getMatchedRoute:function(a){for(var b=
this._routes,c=b.length,d;d=b[--c];)if(d.match(a))return d;return null},toString:function(){return"[crossroads numRoutes:"+this.getNumRoutes()+"]"}};e=new k;e.VERSION="0.6.0+";n.prototype={rules:void 0,match:function(a){return this._matchRegexp.test(a)&&this._validateParams(a)},_validateParams:function(a){var b=this.rules,c=this._getParamsObject(a),d;for(d in b)if(b.hasOwnProperty(d)&&!this._isValidParam(a,d,c))return!1;return!0},_isValidParam:function(a,b,c){var d=this.rules[b],f=c[b],e=!1;f==null&&
this._optionalParamsIds&&j(this._optionalParamsIds,b)!==-1?e=!0:h(d,"RegExp")?e=d.test(f):h(d,"Array")?e=j(d,f)!==-1:h(d,"Function")&&(e=d(f,a,c));return e},_getParamsObject:function(a){for(var b=this._router.shouldTypecast,c=g.getParamValues(a,this._matchRegexp,b),d={},f=c.length;f--;)d[f]=c[f],this._paramsIds&&(d[this._paramsIds[f]]=c[f]);d.request_=b?i(a):a;d.vals_=c;return d},_getParamsArray:function(a){var b=this.rules?this.rules.normalize_:null;return(b=b||this._router.normalizeFn)&&h(b,"Function")?
b(a,this._getParamsObject(a)):g.getParamValues(a,this._matchRegexp,this._router.shouldTypecast)},dispose:function(){this._router.removeRoute(this)},_destroy:function(){this.matched.dispose();this.matched=this._pattern=this._matchRegexp=null},toString:function(){return'[Route pattern:"'+this._pattern+'", numListeners:'+this.matched.getNumListeners()+"]"}};g=e.patternLexer=function(){function a(a,b){for(var c=[],d;d=a.exec(b);)c.push(d[1]);return c}var b=/[\\.+*?\^$\[\](){}\/'#]/g,c=/\/$/g,d=/([:}]|\w(?=\/))\/?(:)/g,
f=/([:}])\/?(\{)/g,e=/\{([^}]+)\}/g,g=/:([^:]+):/g,j=/(?:\{|:)([^}:]+)(?:\}|:)/g,h=RegExp("__CR_RP__","g"),k=RegExp("__CR_OP__","g"),l=RegExp("__CR_OS__","g"),m=RegExp("__CR_RS__","g");return{getParamIds:function(b){return a(j,b)},getOptionalParamsIds:function(b){return a(g,b)},getParamValues:function(a,b,c){if(a=b.exec(a))if(a.shift(),c){c=a;a=c.length;for(b=[];a--;)b[a]=i(c[a]);a=b}return a},compilePattern:function(a){if(a=a||"")a=a.replace(c,""),a=a.replace(d,"$1__CR_OS__$2"),a=a.replace(f,"$1__CR_RS__$2"),
a=a.replace(g,"__CR_OP__"),a=a.replace(e,"__CR_RP__"),a=a.replace(b,"\\$&"),a=a.replace(l,"\\/?"),a=a.replace(m,"\\/"),a=a.replace(k,"([^\\/]+)?/?"),a=a.replace(h,"([^\\/]+)");return RegExp("^"+a+"/?$")}}}();return e})})(typeof define==="function"&&define.amd?define:function(i,e){typeof module!=="undefined"&&module.exports?module.exports=e(require):window[i]=e(function(e){return window[e]})});