/*!
 * Crossroads - JavaScript Routes
 * Released under the MIT license <http://www.opensource.org/licenses/mit-license.php>
 * @author Miller Medeiros
 * @version 0.1
 * @build 9 (04/14/2011 02:27 AM)
 */
(function(a){var d,j,c=Object.prototype.toString;function i(k,l){var m=k.length;while(m--){if(k[m]===l){return m}}return -1}function b(k){return c.call(k)}d=(function(){var n=[],r=new signals.Signal();function k(v,w){var u=new g(v,w);n.push(u);return u}function o(u){var v=q(u);if(v>=0){n.splice(v,1)}u._destroy()}function q(u){return i(n,u)}function t(){var u=l();while(u--){n[u]._destroy()}n.length=0}function l(){return n.length}function m(v){var u=p(v),w=u?s(v,u):null;if(u){w?u.matched.dispatch.apply(u.matched,w):u.matched.dispatch()}else{r.dispatch(v)}}function p(w){var v=0,u;while(u=n[v++]){if(u.match(w)){return u}}return null}function s(v,u){return j.getParamValues(v,u._matchRegexp)}return{_routes:n,addRoute:k,removeRoute:o,removeAllRoutes:t,parse:m,bypassed:r,getNumRoutes:l,toString:function(){return"[crossroads numRoutes:"+l()+"]"}}}());function g(k,l){this._pattern=k;this._paramsId=j.getParamIds(k);this._matchRegexp=j.compilePattern(k);this.matched=new signals.Signal();if(l){this.matched.add(l)}}g.prototype={rules:void (0),match:function(k){return this._matchRegexp.test(k)&&h(this,k)},dispose:function(){d.removeRoute(this)},_destroy:function(){this.matched.dispose();this.matched=this._pattern=this._paramsId=this._matchRegexp=null},toString:function(){return'[Route pattern:"'+this._pattern+'", numListeners:'+this.matched.getNumListeners()+"]"}};function h(l,m){var n=l.rules,k=n?e(l,m):null,o;for(o in n){if(n.hasOwnProperty(o)){if(!f(n[o],k[o],k,m)){return false}}}return true}function f(m,n,k,l){switch(b(m)){case"[object RegExp]":return m.test(n);case"[object Array]":return i(m,n)!==-1;case"[object Function]":return m(n,l,k);default:return false}}function e(l,p){var m=l._paramsId,k=j.getParamValues(p,l._matchRegexp),q={},r=m.length;while(r--){q[m[r]]=k[r]}return q}j=d.patternLexer=(function(){var s=/[\\\.\+\*\?\^\$\[\]\(\)\{\}\/\'\#]/g,m=/([^\/]+)/,r=/\{([^\}]+)\}/g,q="___CR_PARAM___",p=new RegExp(q,"g");function n(y){var x=[],w;while(w=r.exec(y)){x.push(w[1])}return x}function u(w){w=w?o(w):"";w=k(w);w=l(w);return new RegExp("^"+w+"$")}function o(w){return w.replace(r,q)}function l(w){return w.replace(p,m.source)}function k(w){return w.replace(s,"\\$&")}function t(w,y){var x=y.exec(w);if(x){x.shift();x=v(x)}return x}function v(x){var z=x.length,w=[],y;while(y=x[--z]){w[z]=(y===null||y===""||isNaN(y))?y:parseFloat(y)}return w}return{getParamIds:n,getParamValues:t,compilePattern:u}}());a.crossroads=d}(window||this));