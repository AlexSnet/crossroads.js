/** @license
 * crossroads <http://millermedeiros.github.com/crossroads.js/>
 * License: MIT
 * Author: Miller Medeiros
 * Version: 0.7.1 (2012/1/6 19:29)
 */
(function(a){a("crossroads",function(a){function f(a,b){if(a.indexOf)return a.indexOf(b);var c=a.length;while(c--)if(a[c]===b)return c;return-1}function g(a,b){return"[object "+b+"]"===Object.prototype.toString.call(a)}function h(a){return g(a,"RegExp")}function i(a){return g(a,"Array")}function j(a){return g(a,"Function")}function k(a){var b;return a===null||a==="null"?b=null:a==="true"?b=!0:a==="false"?b=!1:a===e||a==="undefined"?b=e:a===""||isNaN(a)?b=a:b=parseFloat(a),b}function l(a){var b=a.length,c=[];while(b--)c[b]=k(a[b]);return c}function m(){this._routes=[],this._prevRoutes=[],this.bypassed=new b.Signal,this.routed=new b.Signal}function n(a,c,e,f){var g=h(a);this._router=f,this._pattern=a,this._paramsIds=g?null:d.getParamIds(this._pattern),this._optionalParamsIds=g?null:d.getOptionalParamsIds(this._pattern),this._matchRegexp=g?a:d.compilePattern(a),this.matched=new b.Signal,this.switched=new b.Signal,c&&this.matched.add(c),this._priority=e||0}var b=a("signals"),c,d,e;return m.prototype={normalizeFn:null,normalizeAsArray:function(){this.normalizeFn=function(a,b){return[b.vals_]}},normalizeAsObject:function(){this.normalizeFn=function(a,b){return[b]}},normalizeAsArguments:function(){this.normalizeFn=null},create:function(){return new m},shouldTypecast:!1,addRoute:function(a,b,c){var d=new n(a,b,c,this);return this._sortedInsert(d),d},removeRoute:function(a){var b=f(this._routes,a);b!==-1&&this._routes.splice(b,1),a._destroy()},removeAllRoutes:function(){var a=this.getNumRoutes();while(a--)this._routes[a]._destroy();this._routes.length=0},parse:function(a){a=a||"";var b=this._getMatchedRoutes(a),c=0,d=b.length,e;if(d){this._notifyPrevRoutes(a),this._prevRoutes=b;while(c<d)e=b[c],e.route.matched.dispatch.apply(e.route.matched,e.params),e.isFirst=!c,this.routed.dispatch(a,e),c+=1}else this.bypassed.dispatch(a)},_notifyPrevRoutes:function(a){var b=0,c;while(c=this._prevRoutes[b++])c.route.switched&&c.route.switched.dispatch(a)},getNumRoutes:function(){return this._routes.length},_sortedInsert:function(a){var b=this._routes,c=b.length;do--c;while(b[c]&&a._priority<=b[c]._priority);b.splice(c+1,0,a)},_getMatchedRoutes:function(a){var b=[],c=this._routes,d=c.length,e;while(e=c[--d])(!b.length||e.greedy)&&e.match(a)&&b.push({route:e,params:e._getParamsArray(a)});return b},toString:function(){return"[crossroads numRoutes:"+this.getNumRoutes()+"]"}},c=new m,c.VERSION="0.7.1",n.prototype={greedy:!1,rules:void 0,match:function(a){return this._matchRegexp.test(a)&&this._validateParams(a)},_validateParams:function(a){var b=this.rules,c=this._getParamsObject(a),d;for(d in b)if(d!=="normalize_"&&b.hasOwnProperty(d)&&!this._isValidParam(a,d,c))return!1;return!0},_isValidParam:function(a,b,c){var d=this.rules[b],e=c[b],g=!1;return e==null&&this._optionalParamsIds&&f(this._optionalParamsIds,b)!==-1?g=!0:h(d)?g=d.test(e):i(d)?g=f(d,e)!==-1:j(d)&&(g=d(e,a,c)),g},_getParamsObject:function(a){var b=this._router.shouldTypecast,c=d.getParamValues(a,this._matchRegexp,b),e={},f=c.length;while(f--)e[f]=c[f],this._paramsIds&&(e[this._paramsIds[f]]=c[f]);return e.request_=b?k(a):a,e.vals_=c,e},_getParamsArray:function(a){var b=this.rules?this.rules.normalize_:null,c;return b=b||this._router.normalizeFn,b&&j(b)?c=b(a,this._getParamsObject(a)):c=d.getParamValues(a,this._matchRegexp,this._router.shouldTypecast),c},dispose:function(){this._router.removeRoute(this)},_destroy:function(){this.matched.dispose(),this.switched.dispose(),this.matched=this.switched=this._pattern=this._matchRegexp=null},toString:function(){return'[Route pattern:"'+this._pattern+'", numListeners:'+this.matched.getNumListeners()+"]"}},d=c.patternLexer=function(){function q(a,b){var c=[],d;while(d=a.exec(b))c.push(d[1]);return c}function r(a){return q(g,a)}function s(a){return q(f,a)}function t(c){return c=c||"",c&&(c=c.replace(b,""),c=u(c),c=c.replace(a,"\\$&"),c=v(c)),new RegExp("^"+c+"/?$")}function u(a){return a=a.replace(c,"$1"+k+"$2"),a=a.replace(d,"$1"+j+"$2"),a=a.replace(f,i),a.replace(e,h)}function v(a){return a=a.replace(o,"\\/?"),a=a.replace(p,"\\/"),a=a.replace(n,"([^\\/]+)?/?"),a.replace(m,"([^\\/]+)")}function w(a,b,c){var d=b.exec(a);return d&&(d.shift(),c&&(d=l(d))),d}var a=/[\\.+*?\^$\[\](){}\/'#]/g,b=/\/$/g,c=/([:}]|\w(?=\/))\/?(:)/g,d=/([:}])\/?(\{)/g,e=/\{([^}]+)\}/g,f=/:([^:]+):/g,g=/(?:\{|:)([^}:]+)(?:\}|:)/g,h="__CR_RP__",i="__CR_OP__",j="__CR_RS__",k="__CR_OS__",m=new RegExp(h,"g"),n=new RegExp(i,"g"),o=new RegExp(k,"g"),p=new RegExp(j,"g");return{getParamIds:r,getOptionalParamsIds:s,getParamValues:w,compilePattern:t}}(),c})})(typeof define=="function"&&define.amd?define:function(a,b){typeof module!="undefined"&&module.exports?module.exports=b(require):window[a]=b(function(a){return window[a]})})